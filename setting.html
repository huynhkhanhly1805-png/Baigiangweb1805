<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>C√†i ƒë·∫∑t</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --blue:#cbe4ff; --accent:#003bff; --muted:#efefef; --card:#fff;
      --page-bg:#dbeffd;
    }
    html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--page-bg);color:#111}
    .dark-mode {
      --blue:#2b3a4b; --accent:#9fc5ff; --muted:#3a3a3a; --card:#222;
      background:#111;
      color:#eaeaea;
    }
    .app{display:flex;height:100vh;overflow:hidden}
    .sidebar{
      width:92px;background:#fff;border-right:1px solid #d6d6d6;
      display:flex;flex-direction:column;align-items:center;padding:14px 8px;gap:10px;
    }
    .sb-item{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:22px}
    .sb-item.active{background:var(--blue)}
    .sb-label{font-size:12px;margin-top:4px;text-align:center;color:#333}
    .sb-spacer{flex:1}
    .logout{margin-bottom:6px;text-align:center;font-size:14px;cursor:pointer}

    .main{flex:1;display:flex;flex-direction:column}
    .topbar{display:flex;align-items:center;gap:12px;background:var(--blue);padding:10px 16px;border-bottom:1px solid #d6d6d6}
    .search{flex:1;display:flex;align-items:center;background:#fff;border:1px solid #d6d6d6;border-radius:8px;padding:6px 10px}
    .search input{border:0;outline:0;font-size:15px;width:100%}
    .icons{display:flex;gap:12px;font-size:20px;margin-left:6px}

    .content{flex:1;display:flex;padding:18px;background:transparent}
    .menu{width:300px;margin-right:18px;background:var(--card);border-radius:8px;box-shadow:0 0 6px rgba(0,0,0,0.06);padding:6px 0;overflow:auto}
    .menu ul{list-style:none;padding:0;margin:0}
    .menu li{padding:14px 18px;border-bottom:1px solid var(--muted);font-size:16px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
    .menu li:hover{background:#f2f8ff}
    .menu li.active{color:var(--accent);font-weight:700}
    .display{flex:1;background:var(--card);border-radius:8px;box-shadow:0 0 8px rgba(0,0,0,0.06);padding:20px;overflow:auto;min-height:60vh}
    .display h2{margin:0 0 12px 0;color:var(--accent)}

    .small{font-size:14px;color:#666}
    input[type=text], input[type=email], input[type=password], textarea, select{
      width:100%;padding:8px;border:1px solid #bdbdbd;border-radius:4px;font-size:15px;background:transparent;
    }
    .box{border:2px solid #bfbfbf;padding:10px;border-radius:6px;background:var(--card)}
    .avatar{width:100px;height:100px;border-radius:999px;border:3px solid #444;display:flex;align-items:center;justify-content:center;font-size:42px;margin:8px auto}
    .section-title{font-weight:700;margin:10px 0}
    .row{display:flex;gap:12px;align-items:center}
    .col{flex:1}

    .switch{position:relative;display:inline-block;width:40px;height:20px}
    .switch input{display:none}
    .slider{position:absolute;left:0;top:0;right:0;bottom:0;background:#c0c0c0;border-radius:20px;transition:.22s}
    .slider::before{content:"";position:absolute;left:2px;top:2px;width:16px;height:16px;background:#fff;border-radius:50%;transition:.22s}
    .switch input:checked + .slider{background:#007bff}
    .switch input:checked + .slider::before{transform:translateX(20px)}

    .modal-back{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:60}
    .modal{background:var(--blue);padding:14px;border-radius:8px;border:2px solid rgba(0,0,0,0.08);min-width:320px}
    .modal p{margin:8px 0;color:#07204a}
    .btn{padding:8px 12px;border-radius:6px;border:0;cursor:pointer}
    .btn-primary{background:#2b7bd6;color:#fff}
    .btn-ghost{background:#fff;border:1px solid #999}

    .stars{display:flex;gap:8px;font-size:24px;cursor:pointer}
    .note{color:#666;margin-top:10px}

    @media(max-width:900px){ .menu{display:none} .sidebar{display:none} .content{padding:8px} }
  </style>
</head>
<body id="pageBody">
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar" aria-label="sidebar">
      <div class="sb-item" data-href="#home" title="Trang ch·ªß">üè†</div>
      <div class="sb-item" onclick='window.location.href="taobaigiang.html"' title="T·∫°o">‚ûï</div>
      <div class="sb-item" onclick='window.location.href="baigiangdaluu.html"' title="B√†i gi·∫£ng ƒë√£ l∆∞u">‚≠ê</div>
      <div class="sb-item" onclick='window.location.href="setting.html"' title="C√†i ƒë·∫∑t">‚öôÔ∏è</div>
      <div class="sb-spacer"></div>
      <div class="logout" id="logoutBtn" title="ƒêƒÉng xu·∫•t">üîÑ<div class="sb-label">ƒêƒÉng xu·∫•t</div></div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="topbar">
        <div class="search">üîç<input id="searchInput" placeholder="T√¨m ki·∫øm c√†i ƒë·∫∑t" /></div>
        <div class="icons">üîî üë§</div>
      </div>

      <div class="content">
        <!-- MENU -->
        <nav class="menu" aria-label="menu-caidat">
          <ul>
            <li data-key="info" class="active">Th√¥ng tin t√†i kho·∫£n <span>‚ñ∂</span></li>
            <li data-key="giao">C√†i ƒë·∫∑t giao di·ªán <span>‚ñ∂</span></li>
            <li data-key="thongbao">C√†i ƒë·∫∑t th√¥ng b√°o <span>‚ñ∂</span></li>
            <li data-key="hotro">H·ªó tr·ª£ <span>‚ñ∂</span></li>
            <li data-key="them">Th√™m t√†i kho·∫£n <span>‚ñ∂</span></li>
            <li data-key="chuyen">Chuy·ªÉn ƒë·ªïi t√†i kho·∫£n <span>‚ñ∂</span></li>
            <li data-key="feedback">Ph·∫£n h·ªìi & ƒê√°nh gi√° <span>‚ñ∂</span></li>
          </ul>
        </nav>

        <!-- DISPLAY AREA -->
        <section class="display" id="display">
          <!-- injected content -->
        </section>
      </div>
    </main>

    <aside style="width:80px;background:var(--blue)"></aside>
  </div>

  <!-- modal root -->
  <div id="modalRoot" style="display:none"></div>

  <script>
    /* ---------- TEMPLATES (10 pages) ---------- */
    const TEMPLATES = {
      homepage: `
        <h2>Trang ch·ªß</h2>
        <p class="small">Xin ch√†o! ƒê√¢y l√† trang ch·ªß demo.</p>
        <div class="box" style="margin-top:12px">
          <strong>B√†i gi·∫£ng n·ªïi b·∫≠t</strong>
          <p class="small">V√≠ d·ª•: B√†i gi·∫£ng AI c∆° b·∫£n</p>
        </div>
      `,
      login: `
        <h2>ƒêƒÉng nh·∫≠p</h2>
        <div style="max-width:420px">
          <label class="small">T√™n ƒëƒÉng nh·∫≠p</label><input id="loginUser" type="text" placeholder="T√™n ƒëƒÉng nh·∫≠p" />
          <div style="height:8px"></div>
          <label class="small">M·∫≠t kh·∫©u</label><input id="loginPass" type="password" placeholder="M·∫≠t kh·∫©u" />
          <div style="height:12px"></div>
          <button class="btn btn-primary" id="loginBtn">ƒêƒÉng nh·∫≠p</button>
        </div>
      `,
      create: `
        <h2>T·∫°o b√†i gi·∫£ng (m·ªõi)</h2>
        <div style="max-width:720px">
          <label class="small">Ti√™u ƒë·ªÅ</label><input id="lesson_title" type="text" placeholder="Ti√™u ƒë·ªÅ..." />
          <div style="height:8px"></div>
          <label class="small">M√¥ t·∫£</label><textarea id="lesson_desc" rows="6" placeholder="M√¥ t·∫£..."></textarea>
          <div style="height:8px"></div>
          <button class="btn btn-primary" id="createLessonBtn">T·∫°o b√†i gi·∫£ng</button>
        </div>
      `,
      settings: `
        <h2>C√†i ƒë·∫∑t (t·ªïng quan)</h2>
        <p class="small">Ch·ªçn b√™n tr√°i ƒë·ªÉ m·ªü chi ti·∫øt c√†i ƒë·∫∑t.</p>
      `,
      info: `
        <h2>Th√¥ng tin t√†i kho·∫£n</h2>
        <ul>
          <li id="t-avatar">·∫¢nh ƒë·∫°i di·ªán <span>‚ñæ</span></li>
          <li id="t-name">T√™n t√†i kho·∫£n <span>‚ñæ</span></li>
          <li id="t-mail">Gmail <span>‚ñæ</span></li>
        </ul>
        <div id="infoDetails" style="margin-top:12px"></div>
      `,
      giao: `
        <h2>C√†i ƒë·∫∑t giao di·ªán</h2>
        <ul>
          <li id="g-mode">Ch·∫ø ƒë·ªô hi·ªÉn th·ªã <span>‚ñæ</span></li>
          <li id="g-font">Ki·ªÉu ch·ªØ / C·ª° ch·ªØ <span>‚ñæ</span></li>
          <li id="g-lang">Ng√¥n ng·ªØ <span>‚ñæ</span></li>
          <li id="g-reset">Kh√¥i ph·ª•c c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh</li>
        </ul>
        <div id="gDetails" style="margin-top:12px"></div>
      `,
      thongbao: `
        <h2>C√†i ƒë·∫∑t th√¥ng b√°o</h2>
        <ul>
          <li>Th√¥ng b√°o c·ªßa ·ª©ng d·ª•ng</li>
          <li>‚û§ B√†i gi·∫£ng m·ªõi <label class="switch"><input id="tb1" type="checkbox" checked><span class="slider"></span></label></li>
          <li>‚û§ B√†i ki·ªÉm tra m·ªõi <label class="switch"><input id="tb2" type="checkbox" checked><span class="slider"></span></label></li>
          <li>Nh·∫≠t k√Ω th√¥ng b√°o <label class="switch"><input id="tb3" type="checkbox" checked><span class="slider"></span></label></li>
          <li>Ch·∫∑n th√¥ng b√°o <label class="switch"><input id="tb4" type="checkbox"><span class="slider"></span></label></li>
        </ul>
      `,
      hotro: `
        <h2>H·ªó tr·ª£</h2>
        <ul>
          <li id="hotro-feat">C√°c t√≠nh nƒÉng <span>‚ñæ</span></li>
          <li id="hotro-req">G·ª≠i y√™u c·∫ßu h·ªó tr·ª£ <span>‚ñæ</span></li>
          <li id="hotro-rate">ƒê√°nh gi√° <span>‚ñæ</span></li>
        </ul>
        <div id="hotroDetails" style="margin-top:12px"></div>
      `,
      them: `
        <h2>Th√™m t√†i kho·∫£n</h2>
        <div class="box" style="max-width:480px">
          <label class="small">T√™n</label><input id="new_name" type="text" placeholder="T√™n" />
          <div style="height:8px"></div>
          <label class="small">Gmail</label><input id="new_mail" type="email" placeholder="you@example.com" />
          <div style="height:8px"></div>
          <label class="small">M·∫≠t kh·∫©u</label><input id="new_pass" type="password" />
          <div style="height:12px"></div>
          <button class="btn btn-primary" id="addAccountBtn">Th√™m t√†i kho·∫£n</button>
        </div>
      `,
      chuyen: `
        <h2>Chuy·ªÉn ƒë·ªïi t√†i kho·∫£n</h2>
        <div class="box" style="max-width:420px">
          <div style="display:flex;align-items:center;gap:12px;padding:8px">
            <div style="width:48px;height:48px;border-radius:50%;background:#f5f5f5;display:flex;align-items:center;justify-content:center">N</div>
            <div>
              <div style="font-weight:600">NguyenA</div>
              <div class="small">nguyena@gmail.com</div>
            </div>
            <div style="margin-left:auto"><button class="btn btn-ghost" id="switchBtn">Chuy·ªÉn ƒë·∫øn</button></div>
          </div>
        </div>
      `,
      feedback: `
        <h2>Ph·∫£n h·ªìi & ƒê√°nh gi√°</h2>
        <div style="max-width:520px">
          <div class="section-title">G·ª≠i y√™u c·∫ßu h·ªó tr·ª£</div>
          <label class="small">T√™n / Gmail</label><input id="fb_name" type="text" placeholder="T√™n ho·∫∑c Gmail" />
          <div style="height:8px"></div>
          <label class="small">V·∫•n ƒë·ªÅ b·∫°n g·∫∑p ph·∫£i</label><textarea id="fb_msg" rows="4" placeholder="M√¥ t·∫£ v·∫•n ƒë·ªÅ..."></textarea>
          <div style="height:8px"></div>
          <button class="btn btn-primary" id="fb_send">G·ª≠i</button>

          <div style="height:16px"></div>
          <div class="section-title">ƒê√°nh gi√° web c·ªßa ch√∫ng t√¥i</div>
          <div class="box" style="padding:12px">
            <div class="stars" id="rating">
              <span data-star="1">‚òÜ</span>
              <span data-star="2">‚òÜ</span>
              <span data-star="3">‚òÜ</span>
              <span data-star="4">‚òÜ</span>
              <span data-star="5">‚òÜ</span>
            </div>
            <div class="note">Ch·ªçn s·ªë sao ƒë·ªÉ ƒë√°nh gi√°</div>
          </div>
        </div>
      `
    };

    /* ---------- CORE (routing + render) ---------- */
    const display = document.getElementById('display');
    const menuItems = Array.from(document.querySelectorAll('.menu li'));
    const sidebarItems = Array.from(document.querySelectorAll('.sb-item'));
    const modalRoot = document.getElementById('modalRoot');
    const body = document.getElementById('pageBody');

    function setActiveMenu(key){
      menuItems.forEach(li => li.classList.toggle('active', li.dataset.key === key));
    }

    function render(key){
      const tpl = TEMPLATES[key] || `<h2>Kh√¥ng t√¨m th·∫•y trang</h2><p class="small">Trang: ${key}</p>`;
      display.innerHTML = tpl;
      setActiveMenu(key);
      attachHandlers(key);
    }

    // attach events per page
    function attachHandlers(key){
      // INFO page
      if(key === 'info'){
        const details = document.getElementById('infoDetails');
        const avatarLi = document.getElementById('t-avatar');
        const nameLi = document.getElementById('t-name');
        const mailLi = document.getElementById('t-mail');

        function showAvatar(){
          details.innerHTML = `<div style="max-width:320px"><div class="section-title">·∫¢nh ƒë·∫°i di·ªán</div><div class="avatar">N</div><div style="text-align:center"><button class="btn btn-ghost" id="chgAvatar">Thay ƒë·ªïi</button></div></div>`;
          document.getElementById('chgAvatar').addEventListener('click', ()=> alert('Thay ·∫£nh (demo)'));
        }
        function showName(){
          details.innerHTML = `<div style="max-width:420px"><div class="section-title">T√™n t√†i kho·∫£n</div><input id="acc_name" type="text" value="NguyenA" /><div style="height:8px"></div><button class="btn btn-primary" id="saveName">L∆∞u</button></div>`;
          document.getElementById('saveName').addEventListener('click', ()=> alert('ƒê√£ l∆∞u: ' + document.getElementById('acc_name').value));
        }
        function showMail(){
          details.innerHTML = `<div style="max-width:420px"><div class="section-title">Gmail</div><input id="acc_mail" type="email" value="nguyenvana@gmail.com" /><div style="height:8px"></div><button class="btn btn-primary" id="saveMail">L∆∞u</button></div>`;
          document.getElementById('saveMail').addEventListener('click', ()=> alert('ƒê√£ l∆∞u: ' + document.getElementById('acc_mail').value));
        }

        avatarLi.addEventListener('click', showAvatar);
        nameLi.addEventListener('click', showName);
        mailLi.addEventListener('click', showMail);
      }

      // GIAO page
      if(key === 'giao'){
        const gDetails = document.getElementById('gDetails');
        const modeLi = document.getElementById('g-mode');
        const fontLi = document.getElementById('g-font');
        const langLi = document.getElementById('g-lang');
        const resetLi = document.getElementById('g-reset');

        function showMode(){
          gDetails.innerHTML = `<div class="box"><div class="section-title">Ch·∫ø ƒë·ªô hi·ªÉn th·ªã</div>
            <label><input type="radio" name="theme" value="light"> S√°ng</label><br>
            <label><input type="radio" name="theme" value="dark"> T·ªëi</label><br>
            <label><input type="radio" name="theme" value="auto"> T·ª± ƒë·ªông</label>
            </div>`;
          const radios = gDetails.querySelectorAll('input[name="theme"]');
          radios.forEach(r => r.addEventListener('change', ()=> applyTheme(r.value)));
          // select saved
          const saved = localStorage.getItem('theme') || 'light';
          const sel = gDetails.querySelector(`input[value="${saved}"]`);
          if(sel) sel.checked = true;
        }
        function showFont(){
          gDetails.innerHTML = `<div class="box"><div class="section-title">Ki·ªÉu ch·ªØ / C·ª° ch·ªØ</div>
            <select id="fontSel"><option value="14">Inter / 14</option><option value="16">Times / 16</option><option value="20">Sansita / 20</option></select></div>`;
          document.getElementById('fontSel').addEventListener('change', e=> document.documentElement.style.fontSize = (e.target.value/14) + 'px');
        }
        function showLang(){
          gDetails.innerHTML = `<div class="box"><div class="section-title">Ng√¥n ng·ªØ</div>
            <select id="langSel"><option value="en">English</option><option value="vi" selected>Ti·∫øng Vi·ªát</option></select></div>`;
          document.getElementById('langSel').addEventListener('change', ()=> alert('ƒê·ªïi ng√¥n ng·ªØ (demo)'));
        }
        function showReset(){
          gDetails.innerHTML = `<div style="max-width:420px"><div class="section-title">Kh√¥i ph·ª•c c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh</div><div class="small">Vi·ªác n√†y s·∫Ω x√≥a d·ªØ li·ªáu c√†i ƒë·∫∑t (demo)</div><div style="height:8px"></div><button class="btn btn-ghost" id="btnReset">Kh√¥i ph·ª•c</button></div>`;
          document.getElementById('btnReset').addEventListener('click', ()=> showModal('B·∫°n ch·∫Øc ch·∫Øn mu·ªën kh√¥i ph·ª•c to√†n b·ªô c√†i ƒë·∫∑t?\\nVi·ªác n√†y s·∫Ω x√≥a t·∫•t c·∫£ d·ªØ li·ªáu b·∫°n ƒë√£ c√†i ƒë·∫∑t.', ()=> { localStorage.removeItem('theme'); alert('ƒê√£ kh√¥i ph·ª•c (demo)'); applyTheme('light'); }));
        }

        modeLi.addEventListener('click', showMode);
        fontLi.addEventListener('click', showFont);
        langLi.addEventListener('click', showLang);
        resetLi.addEventListener('click', showReset);
      }

      // THONGBAO page
      if(key === 'thongbao'){
        ['tb1','tb2','tb3','tb4'].forEach(id=>{
          const el = document.getElementById(id);
          if(el) el.addEventListener('change', ()=> console.log(id, el.checked));
        });
      }

      // HOTRO page
      if(key === 'hotro'){
        const details = document.getElementById('hotroDetails');
        const feat = document.getElementById('hotro-feat');
        const req  = document.getElementById('hotro-req');
        const rate = document.getElementById('hotro-rate');

        function showFeat(){
          details.innerHTML = `<div class="section-title">C√°c t√≠nh nƒÉng</div><div class="box"><div style="display:flex;gap:12px"><div style="width:60px;height:60px;border-radius:999px;background:#ffdede;display:flex;align-items:center;justify-content:center">GV</div><div><strong>Gi√°o vi√™n</strong><ul><li>T·∫°o b√†i gi·∫£ng nhanh</li><li>L∆∞u & chia s·∫ª</li></ul></div></div></div>`;
        }
        function showReq(){
          details.innerHTML = `<div class="section-title">G·ª≠i y√™u c·∫ßu h·ªó tr·ª£</div><div class="box"><label class="small">T√™n/Gmail</label><input id="req_name" type="text" /><div style="height:8px"></div><label class="small">V·∫•n ƒë·ªÅ</label><textarea id="req_msg" rows="4"></textarea><div style="height:8px"></div><button class="btn btn-primary" id="req_send">G·ª≠i</button><button class="btn btn-ghost" id="req_cancel">H·ªßy</button></div>`;
          document.getElementById('req_send').addEventListener('click', ()=> alert('ƒê√£ g·ª≠i y√™u c·∫ßu (demo)'));
          document.getElementById('req_cancel').addEventListener('click', ()=> details.innerHTML = '');
        }
        function showRate(){
          details.innerHTML = `<div class="section-title">ƒê√°nh gi√°</div><div class="box" style="padding:12px"><div style="font-weight:700">ƒê√°nh gi√° web</div><div style="height:8px"></div><div class="stars" id="hotroStars"><span data-star="1">‚òÜ</span><span data-star="2">‚òÜ</span><span data-star="3">‚òÜ</span><span data-star="4">‚òÜ</span><span data-star="5">‚òÜ</span></div></div>`;
          const s = document.getElementById('hotroStars');
          s.querySelectorAll('span').forEach(el=> el.addEventListener('click', ()=> {
            const n = +el.dataset.star;
            s.querySelectorAll('span').forEach(sp => sp.textContent = +sp.dataset.star <= n ? '‚òÖ' : '‚òÜ');
            alert('C·∫£m ∆°n ƒë√°nh gi√° ' + n + ' sao!');
          }));
        }

        feat.addEventListener('click', showFeat);
        req.addEventListener('click', showReq);
        rate.addEventListener('click', showRate);
      }

      // THEM page
      if(key === 'them'){
        const btn = document.getElementById('addAccountBtn');
        if(btn) btn.addEventListener('click', ()=> {
          const n = document.getElementById('new_name').value;
          alert('ƒê√£ th√™m (demo): ' + n);
        });
      }

      // CHUYEN
      if(key === 'chuyen'){
        const btn = document.getElementById('switchBtn');
        if(btn) btn.addEventListener('click', ()=> alert('ƒê√£ chuy·ªÉn (demo)'));
      }

      // CREATEPAGE
      if(key === 'createpage'){
        const btn = document.getElementById('createLessonBtn');
        if(btn) btn.addEventListener('click', ()=> {
          const t = document.getElementById('lesson_title').value;
          alert('ƒê√£ t·∫°o (demo): ' + t);
        });
      }

      // FEEDBACK
      if(key === 'feedback'){
        const send = document.getElementById('fb_send');
        if(send) send.addEventListener('click', ()=> alert('ƒê√£ g·ª≠i ph·∫£n h·ªìi (demo)'));
        const rating = document.getElementById('rating');
        if(rating) rating.querySelectorAll('span').forEach(s=> s.addEventListener('click', ()=>{
          const v = +s.dataset.star;
          rating.querySelectorAll('span').forEach(sp=> sp.textContent = +sp.dataset.star <= v ? '‚òÖ' : '‚òÜ');
          alert('C·∫£m ∆°n ƒë√°nh gi√° ' + v + ' sao!');
        }));
      }

      // LOGIN
      if(key === 'login'){
        const btn = document.getElementById('loginBtn');
        if(btn) btn.addEventListener('click', ()=> {
          const u = document.getElementById('loginUser').value;
          showModal('ƒêƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n: ' + u, ()=> {
            alert('ƒêƒÉng nh·∫≠p (demo): ' + u);
            location.hash = 'info';
          });
        });
      }

      // THONGBAO toggles (already in template) - nothing else needed
    }

    /* ---------- small utilities ---------- */
    function applyTheme(mode){
      if(mode === 'auto'){
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.body.classList.toggle('dark-mode', prefersDark);
      } else if(mode === 'dark'){
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
      localStorage.setItem('theme', mode);
    }

    // showModal: safe string insertion (no nested template issues)
    function showModal(message, onConfirm){
      modalRoot.style.display = 'block';
      const html = '<div class="modal-back"><div class="modal"><p>' + String(message).replace(/\\n/g, '<br/>') + '</p><div style="display:flex;gap:8px;justify-content:center;margin-top:8px"><button class="btn btn-primary" id="mOk">Ch·∫Øc ch·∫Øn</button><button class="btn btn-ghost" id="mCancel">H·ªßy</button></div></div></div>';
      modalRoot.innerHTML = html;
      const ok = document.getElementById('mOk');
      const cancel = document.getElementById('mCancel');
      ok.addEventListener('click', ()=> { modalRoot.style.display = 'none'; modalRoot.innerHTML = ''; if(typeof onConfirm === 'function') onConfirm(); });
      cancel.addEventListener('click', ()=> { modalRoot.style.display = 'none'; modalRoot.innerHTML = ''; });
    }

    /* ---------- routing & interactions ---------- */
    // menu click -> hash
    menuItems.forEach(li => li.addEventListener('click', ()=> location.hash = li.dataset.key));
    // sidebar icons -> hash
    sidebarItems.forEach((sb, idx) => sb.addEventListener('click', ()=> {
      const mapping = ['homepage','login','create','settings','savedpage'];
      const to = sb.dataset.href || ('#' + (mapping[idx] || 'settings'));
      location.hash = to.replace('#','');
    }));
    document.getElementById('logoutBtn').addEventListener('click', ()=> showModal('B·∫°n ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?', ()=> { alert('ƒê√£ ƒëƒÉng xu·∫•t (demo)'); location.hash = 'login'; }));

    function handleHash(){
      const key = location.hash.replace('#','') || 'info';
      render(key);
      // keep sidebar active heuristics
      sidebarItems.forEach(si => si.classList.remove('active'));
      // if page is in settings family -> activate settings icon (index 3)
      if(['info','giao','thongbao','hotro','them','chuyen','feedback'].includes(key)) {
        sidebarItems[3] && sidebarItems[3].classList.add('active');
      } else if(key === 'create' || key === 'createpage') sidebarItems[2] && sidebarItems[2].classList.add('active');
      else if(key === 'login') sidebarItems[1] && sidebarItems[1].classList.add('active');
      else sidebarItems[0] && sidebarItems[0].classList.add('active');
    }
    window.addEventListener('hashchange', handleHash);
    // search filter menu
    document.getElementById('searchInput').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase();
      menuItems.forEach(li => li.style.display = q && !li.textContent.toLowerCase().includes(q) ? 'none' : '');
    });

    // initial
    (function init(){
      // apply saved theme
      const saved = localStorage.getItem('theme') || 'light';
      applyTheme(saved);
      // ensure initial hash
      if(!location.hash) location.hash = 'info';
      handleHash();
    })();
  </script>
</body>
</html>
